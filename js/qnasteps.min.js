(function(a){a.QNAStart=new a.QNAStep("Select the ZIP file to import","Select the ZIP file that contains the valid Publican book that you wish to import into PressGang CCMS.",[new a.QNAVariables(null,[new a.QNAVariable(a.InputEnum.SINGLE_FILE,"Publican ZIP File","ZipFile")])],function(g,d,b,e){(new a.QNAZipModel).getEntries(d.ZipFile,function(f){var c=!1;a.angular.forEach(f,function(a,d){if("publican.cfg"===a.filename)return c=!0,!1});c?(d.ZipFileEntries=f,b(null)):e("Error","The ZIP file did not contain a publican.cfg file.")},
function(a){e("Error","Could not process the ZIP file!")})},function(a,d,b,e){b(h)});var h=new a.QNAStep("Select the main XML file","Select the main XML file from the ZIP archive. Publican conventions mean the file should be named after the book title as defined in Book_Info.xml.",[new a.QNAVariables(null,[new a.QNAVariable(a.InputEnum.LISTBOX,null,"MainXMLFile",function(g,d,b,e){a.angular.forEach(d.ZipFileEntries,function(c,b){if(/^en-US\/Book_Info\.xml$/.test(c.filename))return(new a.QNAZipModel).getEntry(c,
function(c){var b=new a.FileReader;b.addEventListener("load",function(b){if(b=/<title>(.*?)<\/title>/.exec(b.target.result)){var c="en-US/"+b[1].replace(/ /g,"_")+".xml";a.angular.forEach(d.ZipFileEntries,function(a,b){if(a.filename===c)return e(c),!1})}});b.readAsText(c)}),!1});var f=[];a.angular.forEach(d.ZipFileEntries,function(a,b){/^en-US\/.*?\.xml$/.test(a.filename)&&f.push(a.filename)});b(f)})])],null,function(a,d,b,e){})})(this);
