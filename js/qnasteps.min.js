(function(a){a.QNAStart=new a.QNAStep("Select the ZIP file to import","Select the ZIP file that contains the valid Publican book that you wish to import into PressGang CCMS.",[new a.QNAVariables(null,[new a.QNAVariable(a.InputEnum.SINGLE_FILE,"Publican ZIP File","ZipFile")])],function(d,b,c,e){(new a.QNAZipModel).getCachedEntries(b.ZipFile,function(b){var f=!1;a.angular.forEach(b,function(a,b){if("publican.cfg"===a.filename)return f=!0,!1});f?c(null):e("Error","The ZIP file did not contain a publican.cfg file.")},
function(a){e("Error","Could not process the ZIP file!")})},function(a,b,c,e){c(h)});var h=new a.QNAStep("Select the main XML file","Select the main XML file from the ZIP archive. Publican conventions mean the file should be named after the book title in the Book_Info.xml file. This import tool will attempt to read the Book_Info.xml file to find the book title, and from that select the main XML file. You only need to make a manual selection if the import tool could not find the main XML file, or if you want to override the default selection.",
[new a.QNAVariables(null,[new a.QNAVariable(a.InputEnum.LISTBOX,null,"MainXMLFile",function(d,b,c,e){var g=function(){var f=[];(new a.QNAZipModel).getCachedEntries(b.ZipFile,function(b){a.angular.forEach(b,function(a,b){/^.*?\.xml$/.test(a.filename)&&f.push(a.filename)});c(f)})};(new a.QNAZipModel).getCachedEntries(b.ZipFile,function(b){var c=!1;a.angular.forEach(b,function(d,h){if(/^en-US\/Book_Info\.xml$/.test(d.filename))return c=!0,(new a.QNAZipModel).getTextFromFile(d,function(c){if(c=/<title>(.*?)<\/title>/.exec(c)){var d=
"en-US/"+c[1].replace(/ /g,"_")+".xml";a.angular.forEach(b,function(a,b){if(a.filename===d)return e(d),!1})}g()}),!1});c||g()})})])],null,function(a,b,c,e){})})(this);
