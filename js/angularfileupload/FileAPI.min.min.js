(function(a){var l=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,g;if(g=a.Blob)try{g=Boolean(new Blob)}catch(k){g=!1}var n=g;if(g=n)if(g=a.Uint8Array)try{g=100===(new Blob([new Uint8Array(100)])).size}catch(f){g=!1}var c=g,e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,r=(n||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var m,f,v,g;m=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);f=new ArrayBuffer(m.length);v=new Uint8Array(f);
for(g=0;g<m.length;g+=1)v[g]=m.charCodeAt(g);a=a.split(",")[0].split(":")[1].split(";")[0];if(n)return new Blob([c?v:f],{type:a});v=new e;v.append(f);return v.getBlob(a)};a.HTMLCanvasElement&&!l.toBlob&&(l.mozGetAsFile?l.toBlob=function(a,c){a(this.mozGetAsFile("blob",c))}:l.toDataURL&&r&&(l.toBlob=function(a,c){a(r(this.toDataURL(c)))}));"function"===typeof define&&define.amd?define(function(){return r}):a.dataURLtoBlob=r})(this);
(function(a,l){function g(b,F,a){if(b)if(m(b))for(var d=0,c=b.length;d<c;d++)d in b&&F.call(a,b[d],d,b);else for(d in b)b.hasOwnProperty(d)&&F.call(a,b[d],d,b)}function k(b,d,a){if(b){var c=h.uid(b);E[c]||(E[c]={});g(d.split(/\s+/),function(d){p?p.event.add(b,d,a):(E[c][d]||(E[c][d]=[]),E[c][d].push(a),b.addEventListener?b.addEventListener(d,a,!1):b.attachEvent?b.attachEvent("on"+d,a):b["on"+d]=a)})}}function n(b,d,a){if(b){var c=h.uid(b),e=E[c]||{};g(d.split(/\s+/),function(d){if(p)p.event.remove(b,
d,a);else{for(var F=e[d]||[],c=F.length;c--;)if(F[c]===a){F.splice(c,1);break}b.addEventListener?b.removeEventListener(d,a,!1):b.detachEvent?b.detachEvent("on"+d,a):b["on"+d]=null}})}}function f(b,d,a){k(b,d,function Q(c){n(b,d,Q);a(c)})}function c(b,d,a,c,e){b={type:a.type||a,target:b,result:c};h.extend(b,e);d(b)}function e(b,d,a,e){if(h.isFile(b)&&q&&q.prototype["readAs"+a]){var p=new q;k(p,L,function R(a){var e=a.type;"progress"==e?c(b,d,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==
e?(n(p,L,R),p=null):c(b,d,a,a.target.result)});try{if(e)p["readAs"+a](e,b);else p["readAs"+a](b)}catch(m){c(b,d,"error",l,{error:m.toString()})}}else c(b,d,"error",l,{error:"filreader_not_support_"+a})}function r(b){var d;b.getAsEntry?d=b.getAsEntry():b.webkitGetAsEntry&&(d=b.webkitGetAsEntry());return d}function u(b,d){if(b)if(b.isFile)b.file(function(b){d(!1,[b])},function(){d("entry_file")});else if(b.isDirectory){var a=[];b.createReader().readEntries(function(b){h.afor(b,function(b,c){u(c,function(c,
e){c||(a=a.concat(e));b?b():d(!1,a)})})},function(){d("directory_reader")})}else u(r(b),d);else d("empty_entry")}function m(b){return"object"==typeof b&&b&&"length"in b}function B(b){b.target||(b.target=a.event&&a.event.srcElement||N);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}var v=1,D=function(){},t=navigator.userAgent,z=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,s=a.Blob,w=a.File,q=a.FileReader,x=a.FormData,d=a.XMLHttpRequest,p=a.jQuery,
y=!(!w||!q||!a.Uint8Array&&!x&&!d.prototype.sendAsBinary)&&!(/safari\//i.test(t)&&!/chrome\//i.test(t)&&/windows/i.test(t)),t=y&&"withCredentials"in new d,s=y&&!!s&&!(!s.prototype.webkitSlice&&!s.prototype.mozSlice&&!s.prototype.slice),N=a.document,G=a.dataURLtoBlob,U=/img/i,V=/canvas/i,W=/img|canvas/,M=/input/i,J=/^data:[^,]+,/,H=Math.pow,X=Math.round,A=Number,x=function(b){return X(b*this)},I=new A(1024),O=new A(H(I,2)),K=new A(H(I,3)),H=new A(H(I,4)),E={},P=[],L="abort progress error load loadend",
Y="status statusText readyState response responseXML responseText responseBody".split(" "),h={version:"1.2.5",cors:!1,html5:!0,debug:!1,pingUrl:!1,withCredentials:!0,staticPath:"./",flashUrl:0,flashImageUrl:0,accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs",
"video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2E3,KB:(I.from=x,I),MB:(O.from=x,O),GB:(K.from=x,K),TB:(H.from=x,H),expando:"fileapi"+(new Date).getTime(),uid:function(b){return b?b[h.expando]=b[h.expando]||h.uid():(++v,h.expando+v)},log:function(){h.debug&&a.console&&console.log&&(console.log.apply?console.log.apply(console,
arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(d)b=new d;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(c){b=new ActiveXObject("Microsoft.XMLHTTP")}return b},isArray:m,support:{dnd:t&&"ondrop"in N.createElement("div"),cors:t,html5:y,chunked:s,dataURI:!0},event:{on:k,off:n,one:f,fix:B},throttle:function(b,d){var c,e;return function(){e=arguments;c||(b.apply(a,e),c=setTimeout(function(){c=0;b.apply(a,e)},d))}},F:function(){},parseJSON:function(b){return a.JSON&&
JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},defer:function(){var b=[],d,a,c={resolve:function(e,p){c.resolve=D;a=e||!1;for(d=p;p=b.shift();)p(a,d)},then:function(c){a!==l?c(a,d):b.push(c)}};return c},queue:function(b){var d=0,a=0,c=!1,e=!1,p={inc:function(){a++},next:function(){d++;setTimeout(p.check,0)},check:function(){d>=a&&!c&&p.end()},isFail:function(){return c},fail:function(){!c&&
b(c=!0)},end:function(){e||(e=!0,b())}};return p},each:g,afor:function(b,d){var a=0,c=b.length;m(b)&&c--?function C(){d(c!=a&&C,b[a],a++)}():d(!1)},extend:function(b){g(arguments,function(d){g(d,function(d,a){b[a]=d})});return b},isFile:function(b){return y&&b&&b instanceof w},isCanvas:function(b){return b&&V.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,
d){h.isCanvas(b)?c(b,d,"load",h.toDataURL(b)):e(b,d,"DataURL")},readAsBinaryString:function(b,d){q&&q.prototype.readAsBinaryString?e(b,d,"BinaryString"):e(b,function(b){if("load"==b.type)try{b.result=h.toBinaryString(b.result)}catch(a){b.type="error",b.message=a.toString()}d(b)},"DataURL")},readAsArrayBuffer:function(b,d){e(b,d,"ArrayBuffer")},readAsText:function(b,d,a){a||(a=d,d="utf-8");e(b,a,"Text",d)},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},
toBinaryString:function(b){return a.atob(h.toDataURL(b).replace(J,""))},readAsImage:function(b,d,a){if(h.isFile(b))if(z){var e=z.createObjectURL(b);e===l?c(b,d,"error"):h.readAsImage(e,d,a)}else h.readAsDataURL(b,function(e){"load"==e.type?h.readAsImage(e.result,d,a):(a||"error"==e.type)&&c(b,d,e,null,{loaded:e.loaded,total:e.total})});else h.isCanvas(b)?c(b,d,"load",b):U.test(b.nodeName)?b.complete?c(b,d,"load",b):f(b,"error abort load",function C(a){"load"==a.type&&z&&z.revokeObjectURL(b.src);n(b,
"error abort load",C);c(b,d,a,b)}):b.iframe?c(b,d,{type:"error"}):(e=new Image,e.src=b.dataURL||b,h.readAsImage(e,d,a))},checkFileObj:function(b){var d={},a=h.accept;"object"==typeof b?d=b:d.name=(b+"").split(/\\|\//g).pop();null==d.type&&(d.type=d.name.split(".").pop());g(a,function(b,a){b=RegExp(b.replace(/\s/g,"|"),"i");b.test(d.type)&&(d.type=a.split("/")[0]+"/"+d.type)});return d},getDropFiles:function(b,d){var a=[],c=(b.originalEvent||b||"").dataTransfer||{},e=m(c.items)&&c.items[0]&&r(c.items[0]),
p=h.queue(function(){d(a)});g((e?c.items:c.files)||[],function(b){p.inc();if(e)u(b,function(b,d){!b&&a.push.apply(a,d);p.next()});else{var d=function(d){d&&a.push(b);p.next()};if(!b.type&&0==b.size%4096&&102400>=b.size)if(q)try{var c=new q;f(c,L,function(b){b="error"!=b.type;d(b);b&&c.abort()});c.readAsDataURL(b)}catch(m){d(!1)}else d(null);else d(!0)}});p.check()},getFiles:function(b,d,a){var c=[];if(a)return h.filterFiles(h.getFiles(b),d,a),null;b.jquery&&(b.each(function(){c=c.concat(h.getFiles(this))}),
b=c,c=[]);"string"==typeof d&&(d=h.getFilesFilter(d));b.originalEvent?b=B(b.originalEvent):b.srcElement&&(b=B(b));b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?c=b.files:!y&&M.test(b&&b.tagName)?h.trim(b.value)&&(c=[h.checkFileObj(b.value)],c[0].blob=b,c[0].iframe=!0):m(b)&&(c=b);return h.filter(c,function(b){return!d||d.test(b.name)})},getInfo:function(b,d){var a={},c=P.concat();h.isFile(b)?function C(){var e=c.shift();e?e.test(b.type)?e(b,function(b,c){b?d(b):(h.extend(a,c),C())}):
C():d(!1,a)}():d("not_support",a)},addInfoReader:function(b,d){d.test=function(d){return b.test(d)};P.push(d)},filter:function(b,d){for(var a=[],c=0,e=b.length,p;c<e;c++)c in b&&(p=b[c],d.call(p,p,c,b)&&a.push(p));return a},filterFiles:function(b,d,a){if(b.length){var c=b.concat(),e,p=[],m=[];(function S(){c.length?(e=c.shift(),h.getInfo(e,function(b,a){(d(e,b?!1:a)?p:m).push(e);S()})):a(p,m)})()}else a([],b)},upload:function(b){b=h.extend({prepare:h.F,beforeupload:h.F,upload:h.F,fileupload:h.F,fileprogress:h.F,
filecomplete:h.F,progress:h.F,complete:h.F,pause:h.F,chunkSize:h.chunkSize,chunkUpoloadRetry:h.chunkUploadRetry},b);b.imageAutoOrientation&&!b.imageTransform&&(b.imageTransform={rotate:"auto"});var d=new h.XHR(b),a=this._getFilesDataArray(b.files),c=0,e=0,p=this,m,f=!1;g(a,function(b){c+=b.size});d.files=[];g(a,function(b){d.files.push(b.file)});d.total=c;d.loaded=0;b.beforeupload(d,b);(m=function T(){var m=a.shift(),u=m&&m.file,y=!1,v={};g(b,function(b,d){b&&"object"===typeof b&&(b=h.extend({},b));
v[d]=b});u&&u.name===h.expando&&(u=null,h.log("[warn] FileAPI.upload() \u2014 called without files"));("abort"!=d.statusText||d.current)&&m?(f=!1,(d.currentFile=u)&&b.prepare(u,v),this._getFormData(v,m,function(a){e||b.upload(d,b);var f=new h.XHR(h.extend({},v,{upload:u?function(){b.fileupload(u,f,v)}:D,progress:u?function(a){y||(b.fileprogress({type:"progress",total:m.total=a.total,loaded:m.loaded=a.loaded},u,f,v),b.progress({type:"progress",total:c,loaded:d.loaded=e+a.loaded/a.total*m.size|0},u,
f,v))}:D,complete:function(a){y=!0;g(Y,function(b){d[b]=f[b]});u&&(m.loaded=m.total,this.progress(m),e+=m.size,d.loaded=e,b.filecomplete(a,f,u,v));T.call(p)}}));d.abort=function(b){this.current=b;f.abort()};f.send(a)})):(b.complete(200==d.status||201==d.status?!1:d.statusText||"error",d,b),f=!0)}).call(this);d.append=function(b,e){b=h._getFilesDataArray([].concat(b));g(b,function(b){c+=b.size;d.files.push(b.file);e?a.unshift(b):a.push(b)});f&&m.call(p)};d.remove=function(b){var d=-1;g(a,function(c){d++;
if(c.file==b)return a.splice(d,1)})};return d},_getFilesDataArray:function(b){var d=[],a={};if(M.test(b&&b.tagName)){var c=h.getFiles(b);a[b.name||"file"]=null!==b.getAttribute("multiple")?c:c[0]}else m(b)&&M.test(b[0]&&b[0].tagName)?g(b,function(b){a[b.name||"file"]=h.getFiles(b)}):a=b;g(a,function C(b,a){m(b)?g(b,function(b){C(b,a)}):b&&b.name&&d.push({name:a,file:b,size:b.size,total:b.size,loaded:0})});d.length||d.push({file:{name:h.expando}});return d},_getFormData:function(b,d,a){var c=d.file,
e=d.name,p=c.name,m=c.type;d=h.support.transform&&b.imageTransform;var f=new h.Form,u=h.queue(function(){a(f)}),y=d&&(0<parseInt(d.maxWidth||d.minWidth||d.width,10)||d.rotate);h.Image&&d&&(/image/.test(c.type)||W.test(c.nodeType))?(u.inc(),y&&(d=[d]),h.Image.transform(c,d,b.imageAutoOrientation,function(d,a){y&&!d?(!G&&!h.flashEngine&&(a[0]=h.toBinaryString(a[0]),f.multipart=!0),f.append(e,a[0],p,m)):(d||(g(a,function(b,d){!G&&!h.flashEngine&&(b=h.toBinaryString(b),f.multipart=!0);f.append(e+"["+
d+"]",b,p,m)}),e+="[original]"),(d||b.imageOriginal)&&f.append(e,c,p,m));u.next()})):p!==h.expando&&f.append(e,c,p);g(b.data,function Z(b,d){"object"==typeof b?g(b,function(b,a){Z(b,d+"["+a+"]")}):f.append(d,b)});u.check()},reset:function(b){var d,a;p?(a=p(b).clone(!0).insertBefore(b).val("")[0],p(b).remove()):(d=b.parentNode,a=d.insertBefore(b.cloneNode(!0),b),a.value="",d.removeChild(b),g(E[h.uid(b)],function(d,c){g(d,function(d){n(b,c,d);k(a,c,d)})}));return a},load:function(b,d){var a=h.getXHR();
a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),k(a,"progress",function(b){b.lengthComputable&&d({type:b.type,loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var c={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+h.encode64(a.responseBody||a.responseText);d({type:"load",
result:c})}else d({type:"error"})},a.send(null)):d({type:"error"});return a},encode64:function(b){var d="",a=0;for("string"!==typeof b&&(b=String(b));a<b.length;){var c=b.charCodeAt(a++)&255,e=b.charCodeAt(a++)&255,p=b.charCodeAt(a++)&255,m=c>>2,c=(c&3)<<4|e>>4;isNaN(e)?e=p=64:(e=(e&15)<<2|p>>6,p=isNaN(p)?64:p&63);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)}return d}};h.addInfoReader(/^image/,function(b,d){if(!b.__dimensions){var a=b.__dimensions=h.defer();h.readAsImage(b,function(b){var d=b.target;a.resolve("load"==b.type?!1:"error",{width:d.width,height:d.height})})}b.__dimensions.then(d)});h.event.dnd=function(b,d,a){var c,e;a||(a=d,d=h.F);q?(k(b,"dragenter dragleave dragover",function(b){for(var a=((b.originalEvent||b||"").dataTransfer||{}).types,p=a&&a.length;p--;)~a[p].indexOf("File")&&
(b.preventDefault(),e!==b.type&&(e=b.type,"dragleave"!=e&&d.call(b.currentTarget,!0,b),clearTimeout(c),c=setTimeout(function(){d.call(b.currentTarget,"dragleave"!=e,b)},50)))}),k(b,"drop",function(b){b.preventDefault();e=0;d.call(b.currentTarget,!1,b);h.getDropFiles(b,function(d){a.call(b.currentTarget,d,b)})})):h.log("Drag'n'Drop -- not supported")};p&&!p.fn.dnd&&(p.fn.dnd=function(b,d){return this.each(function(){h.event.dnd(this,b,d)})});a.FileAPI=h.extend(h,a.FileAPI);h.flashUrl||(h.flashUrl=
h.staticPath+"FileAPI.flash.swf");h.flashImageUrl||(h.flashImageUrl=h.staticPath+"FileAPI.flash.image.swf")})(window);
(function(a,l,g){function k(a,c){if(!(this instanceof k))return new k(a);this.file=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var n=Math.min,f=Math.round,c=!1,e={8:270,3:180,6:90};try{c=-1<l.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(r){}k.prototype={constructor:k,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,e,f){e===g&&(e=a,f=c,a=c=0);return this.set({sx:a,sy:c,sw:e,sh:f||e})},resize:function(a,
c,e){"string"==typeof c&&(e=c,c=a);return this.set({dw:a,dh:c,resize:e})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,e){var f=this;a.readAsImage(c,function(a){e.call(f,"load"!=a.type,a.result)})},_apply:function(a,c){var e=l.createElement("canvas"),f=this.getMatrix(a),g=e.getContext("2d"),n=f.deg,r=f.dw,s=f.dh,w=a.width,q=a.height,k,d=a;if(this.better)for(;2<Math.min(w/r,q/s);)w=~~(w/2+0.5),q=~~(q/2+0.5),k=
l.createElement("canvas"),k.width=w,k.height=q,d!==a?(k.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,w,q),d=k):(d=k,d.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,w,q),f.sx=f.sy=f.sw=f.sh=0);e.width=n%180?s:r;e.height=n%180?r:s;g.rotate(n*Math.PI/180);g.drawImage(d,f.sx,f.sy,f.sw||d.width,f.sh||d.height,180==n||270==n?-r:0,90==n||180==n?-s:0,r,s);c.call(this,!1,e)},getMatrix:function(c){var e=a.extend({},this.matrix),g=e.sw=e.sw||c.width;c=e.sh=e.sh||c.height;var r=e.dw=e.dw||e.sw,
l=e.dh=e.dh||e.sh,t=g/c,k=r/l,s=e.resize;if("preview"==s){if(r!=g||l!=c)if(k>=t?(t=g,s=t/k):(s=c,t=s*k),t!=g||s!=c)e.sx=~~((g-t)/2),e.sy=~~((c-s)/2),g=t,c=s}else s&&("min"==s?(r=f(t<k?n(g,r):l*t),l=f(t<k?r/t:n(c,l))):(r=f(t>=k?n(g,r):l*t),l=f(t>=k?r/t:n(c,l))));e.sw=g;e.sh=c;e.dw=r;e.dh=l;return e},_trans:function(a){this._load(this.file,function(c,e){c?a(c):this._apply(e,a)})},get:function(c){if(a.support.transform){var f=this;"auto"==f.matrix.deg?a.getInfo(this.file,function(a,g){f.matrix.deg=e[g&&
g.exif&&g.exif.Orientation]||0;f._trans(c)}):f._trans(c)}else c("not_support")},toData:function(a){this.get(a)}};k.exifOrientation=e;k.transform=function(c,e,f,r){a.getInfo(c,function(n,l){var z={},s=a.queue(function(a){r(a,z)});n?s.fail():a.each(e,function(a,e){if(!s.isFail()){var m=k(l.nodeType?l:c);if("function"==typeof a)a(l,m);else if(a.width)m[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(l.width>a.maxWidth||l.height>a.maxHeight)&&m.resize(a.maxWidth,a.maxHeight,"max");
a.rotate===g&&f&&(a.rotate="auto");m.rotate(a.rotate);s.inc();m.toData(function(d,a){d?s.fail():(z[e]=a,s.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=k})(FileAPI,document);
(function(a,l,g){var k=l.encodeURIComponent,n=l.FormData;l=function(){this.items=[]};l.prototype={append:function(a,c,e,g){this.items.push({name:a,blob:c&&c.blob||(void 0==c?"":c),file:c&&(e||c.name),type:c&&(g||c.type)})},each:function(a){for(var c=0,e=this.items.length;c<e;c++)a.call(this,this.items[c])},toData:function(f,c){c._chunked=a.support.chunked&&0<c.chunkSize&&1==a.filter(this.items,function(a){return a.file}).length;a.support.html5?this.multipart||!n?(a.log("FileAPI.Form.toMultipartData"),
this.toMultipartData(f)):c._chunked?(a.log("FileAPI.Form.toPlainData"),this.toPlainData(f)):(a.log("FileAPI.Form.toFormData"),this.toFormData(f)):(a.log("FileAPI.Form.toHtmlData"),this.toHtmlData(f))},_to:function(f,c,e,g){var n=a.queue(function(){c(f)});this.each(function(a){e(a,f,n,g)});n.check()},toHtmlData:function(f){this._to(g.createDocumentFragment(),f,function(c,e){var f=c.blob,n;c.file?(a.reset(f),f.name=c.name,e.appendChild(f)):(n=g.createElement("input"),n.name=c.name,n.type="hidden",n.value=
f,e.appendChild(n))})},toPlainData:function(a){this._to({},a,function(a,e,f){a.file&&(e.type=a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){e.name=a.name;e.file=g;e.size=g.length;e.type=a.type;f.next()},"image/png")):a.file?(e.name=a.blob.name,e.file=a.blob,e.size=a.blob.size,e.type=a.type):(e.params||(e.params=[]),e.params.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.blob)));e.start=-1;e.end=e.file.FileAPIReadPosition||-1;e.retry=0})},toFormData:function(a){this._to(new n,a,
function(a,e,f){a.file&&e.append("_"+a.name,a.file);a.blob&&a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){e.append(a.name,g,a.file);f.next()},"image/png")):a.file?e.append(a.name,a.blob,a.file):e.append(a.name,a.blob)})},toMultipartData:function(f){this._to([],f,function(c,e,f,g){var m=!!c.file,n=c.blob,l=function(a){e.push("--_"+g+('\r\nContent-Disposition: form-data; name="'+c.name+'"'+(m?'; filename="'+k(c.file)+'"':"")+(m?"\r\nContent-Type: "+(c.type||"application/octet-stream"):"")+"\r\n\r\n"+
(m?a:k(a))+"\r\n"));f.next()};f.inc();a.isFile(n)?a.readAsBinaryString(n,function(a){"load"==a.type&&l(a.result)}):l(n)},a.expando)}};a.Form=l})(FileAPI,window,document);
(function(a,l){var g=function(){},k=function(a){this.uid=l.uid();this.xhr={abort:g,getResponseHeader:g,getAllResponseHeaders:g};this.options=a};k.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(n,f){var c=this,e=c.options;c.end=c.abort=g;c.status=n;f&&(c.statusText=f);l.log("xhr.end:",n,f);e.complete(200==n||201==n?!1:c.statusText||"unknown",c);c.xhr&&c.xhr.node&&
setTimeout(function(){var e=c.xhr.node;try{e.parentNode.removeChild(e)}catch(f){}try{delete a[c.uid]}catch(g){}a[c.uid]=c.xhr.node=null},9)},abort:function(){this.end(0,"abort");this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(a){var f=this,c=this.options;a.toData(function(a){c.upload(c,f);f._send.call(f,c,a)},c)},_send:function(g,f){var c=this,e,r=c.uid,k=g.url;l.log("XHR._send:",f);k+=(~k.indexOf("?")?"&":"?")+l.uid();f.nodeName?(g.upload(g,c),e=document.createElement("div"),e.innerHTML=
'<form target="'+r+'" action="'+k+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+r+'" src="javascript:false;"></iframe><input value="'+r+'" name="callback" type="hidden"/></form>',c.xhr.abort=function(){var a=e.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(c){}e=null},k=e.getElementsByTagName("form")[0],
k.appendChild(f),l.log(k.parentNode.innerHTML),document.body.appendChild(e),c.xhr.node=e,a[r]=function(a,f,g){c.readyState=4;c.responseText=g;c.end(a,f);e=null},c.readyState=2,k.submit(),k=null):this.xhr&&this.xhr.aborted?l.log("Error: already aborted"):(e=c.xhr=l.getXHR(),f.params&&(k+=(0>k.indexOf("?")?"?":"&")+f.params.join("&")),e.open("POST",k,!0),l.withCredentials&&(e.withCredentials="true"),(!g.headers||!g.headers["X-Requested-With"])&&e.setRequestHeader("X-Requested-With","XMLHttpRequest"),
l.each(g.headers,function(a,c){e.setRequestHeader(c,a)}),g._chunked?(e.upload&&e.upload.addEventListener("progress",function(a){f.retry||g.progress({type:a.type,total:f.size,loaded:f.start+a.loaded,totalSize:f.size},c,g)},!1),e.onreadystatechange=function(){c.status=e.status;c.statusText=e.statusText;c.readyState=e.readyState;if(4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})c["response"+a]=e["response"+a];e.onreadystatechange=null;if(!e.status||0<e.status-201)if(l.log("Error: "+e.status),
(!e.status&&!e.aborted||500==e.status||416==e.status)&&++f.retry<=g.chunkUploadRetry){a=e.status?0:l.chunkNetworkDownRetryTimeout;g.pause(f.file,g);var k=parseInt(e.getResponseHeader("X-Last-Known-Byte"),10);l.log("X-Last-Known-Byte: "+k);f.end=k?k:f.start-1;setTimeout(function(){c._send(g,f)},a)}else c.end(e.status);else f.retry=0,f.end==f.size-1?c.end(e.status):(k=parseInt(e.getResponseHeader("X-Last-Known-Byte"),10),l.log("X-Last-Known-Byte: "+k),k&&(f.end=k),f.file.FileAPIReadPosition=f.end,setTimeout(function(){c._send(g,
f)},0));e=null}},f.start=f.end+1,f.end=Math.max(Math.min(f.start+g.chunkSize,f.size)-1,f.start),(r="slice")in f.file||(r="mozSlice")in f.file||(r="webkitSlice"),e.setRequestHeader("Content-Range","bytes "+f.start+"-"+f.end+"/"+f.size),e.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(f.name)),e.setRequestHeader("Content-Type",f.type||"application/octet-stream"),r=f.file[r](f.start,f.end+1),e.send(r),r=null):(e.upload&&e.upload.addEventListener("progress",l.throttle(function(a){g.progress(a,
c,g)},100),!1),e.onreadystatechange=function(){c.status=e.status;c.statusText=e.statusText;c.readyState=e.readyState;if(4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})c["response"+a]=e["response"+a];e.onreadystatechange=null;c.end(e.status);e=null}},l.isArray(f)?(e.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+l.expando),f=f.join("")+"--_"+l.expando+"--",e.sendAsBinary?e.sendAsBinary(f):(r=Array.prototype.map.call(f,function(a){return a.charCodeAt(0)&255}),e.send((new Uint8Array(r)).buffer))):
e.send(f)))}};l.XHR=k})(window,FileAPI);
(function(a,l,g){var k=a.support,n=l.navigator,f=n.mimeTypes,c=!1;if(n.plugins&&"object"==typeof n.plugins["Shockwave Flash"])c=n.plugins["Shockwave Flash"].description&&!(f&&f["application/x-shockwave-flash"]&&!f["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!l.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){a.log("ShockwaveFlash.ShockwaveFlash -- does not supported.")}k.flash=c;if(a.support.flash&&(!a.html5||!a.support.html5||a.cors&&!a.support.cors)){var r=
function(a){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+
(a.width||"100%")+'" height="'+(a.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/ig,function(c,e){return a[e]})},u=function(a,c){if(a&&a.style){var e,f;for(e in c){f=c[e];"number"==typeof f&&(f+="px");try{a.style[e]=f}catch(g){}}}},m=function(d,c){a.each(c,function(a,c){var e=d[c];d[c]=function(){this.parent=e;return a.apply(this,arguments)}})},B=function(d){var c=d.wid=a.uid();q._fn[c]=d;return"FileAPI.Flash._fn."+c},
v=function(a){try{q._fn[a.wid]=null,delete q._fn[a.wid]}catch(c){}},D=function(a,c){if(!w.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0)){var e=location.pathname,e=e.substr(0,e.lastIndexOf("/"));a=(e+"/"+a).replace("/./","/")}"//"!=a.substr(0,2)&&(a="//"+location.host+a);w.test(a)||(a=location.protocol+a)}c&&(a+=(/\?/.test(a)?"&":"?")+c);return a},t=a.uid(),z=0,s={},w=/^https?:/i,q={_fn:{},init:function(){var d=g.body&&g.body.firstChild;if(d){do if(1==d.nodeType){a.log("FlashAPI.Flash.init...");var c=
g.createElement("div");u(c,{top:1,right:1,width:5,height:5,position:"absolute"});d.parentNode.insertBefore(c,d);q.publish(c,t);return}while(d=d.nextSibling)}10>z&&setTimeout(q.init,50*++z)},publish:function(d,c){d.innerHTML=r({id:c,src:D(a.flashUrl,"r="+a.version),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.version+(q.isReady||(a.pingUrl?"&ping="+a.pingUrl:""))})},ready:function(){q.ready=a.F;q.isReady=!0;q.patch();
a.event.on(g,"mouseover",q.mouseover);a.event.on(g,"click",function(a){q.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;while((a=a.parentNode)&&a!==g.body)},mouseover:function(d){d=a.event.fix(d).target;if(/input/i.test(d.nodeName)&&"file"==d.type){var c=d.getAttribute(t);if("i"==c||"r"==c)return!1;if("p"!=c){d.setAttribute(t,"i");var c=g.createElement("div"),e=q.getWrapper(d);if(!e){a.log("flash.mouseover.error: js-fileapi-wrapper not found");
return}u(c,{top:0,left:0,width:d.offsetWidth+100,height:d.offsetHeight+100,zIndex:"1000000",position:"absolute"});e.appendChild(c);q.publish(c,a.uid());d.setAttribute(t,"p")}return!0}},event:function(d){var c=d.type;if("ready"==c){try{q.getInput(d.flashId).setAttribute(t,"r")}catch(e){}q.ready();setTimeout(function(){q.mouseenter(d)},50);return!0}"ping"===c?a.log("(flash -> js).ping:",[d.status,d.savedStatus],d.error):"log"===c?a.log("(flash -> js).log:",d.target):c in q&&setTimeout(function(){a.log("Flash.event."+
d.type+":",d);q[c](d)},1)},mouseenter:function(d){var c=q.getInput(d.flashId);if(c){q.cmd(d,"multiple",null!=c.getAttribute("multiple"));var e=[],f={};a.each((c.getAttribute("accept")||"").split(/,\s*/),function(d){a.accept[d]&&a.each(a.accept[d].split(" "),function(a){f[a]=1})});a.each(f,function(a,d){e.push(d)});q.cmd(d,"accept",e.length?e.join(",")+","+e.join(",").toUpperCase():"*")}},get:function(a){return g[a]||l[a]||g.embeds[a]},getInput:function(d){try{var c=q.getWrapper(q.get(d));if(c)return c.getElementsByTagName("input")[0]}catch(e){a.log('Can not find "input" by flashId:',
d,e)}},select:function(d){var c=q.getInput(d.flashId),e=a.uid(c);d=d.target.files;a.each(d,function(d){a.checkFileObj(d)});s[e]=d;g.createEvent?(e=g.createEvent("Event"),e.initEvent("change",!0,!1),c.dispatchEvent(e)):g.createEventObject&&(e=g.createEventObject(),c.fireEvent("onchange",e))},cmd:function(d,c,e,f){try{return a.log("(js -> flash)."+c+":",e),q.get(d.flashId||d).cmd(c,e)}catch(g){a.log("(js -> flash).onError:",g),f||setTimeout(function(){q.cmd(d,c,e,!0)},50)}},patch:function(){a.flashEngine=
a.support.transform=!0;m(a,{getFiles:function(d,c,e){if(e)return a.filterFiles(a.getFiles(d),c,e),null;var f=a.isArray(d)?d:s[a.uid(d.target||d.srcElement||d)];if(!f)return this.parent.apply(this,arguments);c&&(c=a.getFilesFilter(c),f=a.filter(f,function(a){return c.test(a.name)}));return f},getInfo:function(d,c){if(d&&!d.flashId)this.parent.apply(this,arguments);else{if(!d.__info){var e=d.__info=a.defer();q.cmd(d,"getFileInfo",{id:d.id,callback:B(function G(a,c){v(G);e.resolve(a,d.info=c)})})}d.__info.then(c)}}});
a.support.transform=!0;a.Image&&m(a.Image.prototype,{get:function(a,c){this.set({scaleMode:c||"noScale"});this.parent(a)},_load:function(d,c){a.log("FileAPI.Image._load:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var e=this;a.getInfo(d,function(a){c.call(e,a,d)})}},_apply:function(d,c){a.log("FileAPI.Image._apply:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var e=this.getMatrix(d.info);q.cmd(d,"imageTransform",{id:d.id,matrix:e,callback:B(function G(f,l){a.log("FileAPI.Image._apply.callback:",
f);v(G);if(f)c(f);else if(!a.support.dataURI||3E4<l.length){var k={width:e.deg%180?e.dh:e.dw,height:e.deg%180?e.dw:e.dh,scale:e.scaleMode},m=c,n=function(){try{q.get(t).setImage(l)}catch(d){a.log('flash.setImage -- can not set "base64":',d)}},s,t=a.uid(),A=g.createElement("div");for(s in k)A.setAttribute("data-img-"+s,k[s]);u(A,k);A.innerHTML=r(a.extend({id:t,src:D(a.flashImageUrl,"r="+a.uid()),wmode:"opaque",flashvars:"scale="+k.scale+"&callback="+B(function K(){v(K);setTimeout(n,99);return!0})},
k));m(!1,A);A=null}else{var w=new Image;a.event.one(w,"error abort load",function(a){c("load"!=a.type&&a.type,w);w=null});w.src="data:"+d.type+";base64,"+l}})})}},toData:function(d){var c=this.file,e=c.info,f=this.getMatrix(e);c&&!c.flashId?this.parent.apply(this,arguments):("auto"==f.deg&&(f.deg=a.Image.exifOrientation[e&&e.exif&&e.exif.Orientation]||0),d.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:f}))}});m(a.Form.prototype,{toData:function(d){for(var c=this.items,
e=c.length;e--;)if(c[e].file&&c[e].blob&&!c[e].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");d(c)}});m(a.XHR.prototype,{_send:function(c,e){if(e.nodeName||e.append&&a.support.html5||a.isArray(e)&&"string"===typeof e[0])return this.parent.apply(this,arguments);var f={},g={},k=this,l,m;a.each(e,function(a){a.file?(g[a.name]=a={id:a.blob.id,name:a.blob.name,matrix:a.blob.matrix,flashId:a.blob.flashId},m=a.id,l=a.flashId):f[a.name]=a.blob});if(!m&&!l)return this.parent.apply(this,
arguments);a.log("flash.XHR._send:",l,m,g);k.xhr={headers:{},abort:function(){q.cmd(l,"abort",{id:m})},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};var n=a.queue(function(){q.cmd(l,"upload",{url:D(c.url),data:f,files:g,headers:c.headers,callback:B(function J(e){var f=e.type,g=e.result;a.log("flash.upload."+f+":",e);if("progress"==f)e.loaded=Math.min(e.loaded,e.total),e.lengthComputable=!0,c.progress(e);else if("complete"==f)v(J),"string"==
typeof g&&(k.responseText=g.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),k.end(e.status||200);else if("abort"==f||"error"==f)k.end(e.status||0,e.message),v(J)})})});a.each(g,function(c){n.inc();a.getInfo(c,n.next)});n.check()}})}};a.Flash=q;var x=new Image;a.event.one(x,"error load",function(){a.support.dataURI=!(1!=x.width||1!=x.height);x=null;q.init()});x.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,window,document);
"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});
